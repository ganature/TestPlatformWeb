<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">新增</h4>
                <div class="modal-body">
                </div>

                {% for field in obj_form %}
                    <div class="form-group">
                        <label for={{ field.id_for_label }}>{{ field.label }}</label>
                        {{ field }}
                    </div>
                {% endfor %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal"><span
                        class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
                </button>
                <button type="submit" id="btn_submit" class="btn btn-primary" data-dismiss="modal"><span
                        class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存
                </button>
            </div>
            <script>
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = jQuery.trim(cookies[i]);
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }

                var csrftoken = getCookie('csrftoken');

                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $("#btn_submit").click(function () {
                    var url;
                    if ($("#myModalLabel").text = "新增") {
                        url = "{% url 'project:project_add' %}";
                        console.log(csrftoken);
                        $.ajax({
                            url: url,
                            type: 'POST',
                            beforeSend: function (xhr, settings) {
                                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                                }
                            },

                            data: {
                                "name": $("#id_name").val(),
                                "type": $("#id_type").val(),
                                "url":$("#id_url").val(),
                                "creator":{{ request.user.id }}

                            },
                            success: function (data) {
                                if (data.error_code = 0) {
                                    toastr.success("保存成功");
                                }
                                else {
                                    toastr.warning(data.data);
                                }
                            }
                        })
                    }
                    else {
                        url = "{% url 'project:project_detail' %}";
                        $.ajax(
                            {
                                url: url,
                                type: 'POST',
                                data: {'project_id': row.id},
                                success: function (data) {
                                    if (data.error_code = 0) {
                                        toastr.success("保存成功");
                                    }
                                    else {
                                        toastr.warning(data.data);
                                    }
                                },
                                fail: function (data) {
                                    toastr.error(data.data);
                                }

                            }
                        )
                    }


                });


            </script>
        </div>
    </div>
</div>